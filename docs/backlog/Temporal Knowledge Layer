# ALEXANDRIA TEMPORAL KNOWLEDGE LAYER
## Backlog Brief v0.1

### VIZIJA
Vremenska dimenzija znanja. Alexandria prestaje biti "baza knjiga" 
i postaje MAPA INTELEKTUALNOG PUTOVANJA kroz prostor znanja.
Svaki upit ima kontekst: odakle dolaziÅ¡, Å¡to znaÅ¡, kamo ideÅ¡.

Powered by Graphiti + Neo4j.

---

### PROBLEM

KlasiÄni RAG je AMNEZIÄŒAN:
- "NaÄ‘i sliÄno" â†’ evo 5 chunkova
- Nema povijesti interakcija
- Nema evolucije razumijevanja
- Svaki upit je "prvi put"

Znanje nije snapshot. Znanje je PUTOVANJE.

---

### ARHITEKTURA
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           GRAPHITI KNOWLEDGE GRAPH                  â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â”‚
â”‚                                                     â”‚
â”‚  ENTITETI:                                          â”‚
â”‚  â”œâ”€â”€ ðŸ“š Knjige                                      â”‚
â”‚  â”œâ”€â”€ ðŸ‘¤ Autori                                      â”‚
â”‚  â”œâ”€â”€ ðŸ’¡ Koncepti                                    â”‚
â”‚  â”œâ”€â”€ ðŸ›ï¸ Å kole miÅ¡ljenja                            â”‚
â”‚  â”œâ”€â”€ ðŸ“… Periode                                     â”‚
â”‚  â””â”€â”€ ðŸ§‘ Korisnici                                   â”‚
â”‚                                                     â”‚
â”‚  RELACIJE (temporalne):                             â”‚
â”‚  â”œâ”€â”€ NAPISAO (autor â†’ knjiga)                       â”‚
â”‚  â”œâ”€â”€ CITIRA (knjiga â†’ knjiga)                       â”‚
â”‚  â”œâ”€â”€ POVEZAN_S (koncept â†” koncept)                  â”‚
â”‚  â”œâ”€â”€ PRIPADA (knjiga â†’ Å¡kola)                       â”‚
â”‚  â”œâ”€â”€ ÄŒITAO (korisnik â†’ knjiga) [KADA]               â”‚
â”‚  â”œâ”€â”€ TRAÅ½IO (korisnik â†’ koncept) [KADA]             â”‚
â”‚  â””â”€â”€ NAÅ AO_KORISNIM (korisnik â†’ chunk) [KADA]       â”‚
â”‚                                                     â”‚
â”‚  BI-TEMPORALNI MODEL:                               â”‚
â”‚  â”œâ”€â”€ t_event: Kad se DOGODILO                       â”‚
â”‚  â””â”€â”€ t_ingested: Kad smo SAZNALI                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              QDRANT VECTOR LAYER                    â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â”‚
â”‚  â€¢ Chunk embeddinzi                                 â”‚
â”‚  â€¢ Semantic similarity                              â”‚
â”‚  â€¢ Full-text search                                 â”‚
â”‚  â€¢ Brzi content retrieval                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              9000 KNJIGA (Calibre)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### QUERY FLOW
```
UPIT: "Knjige o consciousness koje koriste matematiku"

KORAK 1: GRAPHITI - Graph Traversal
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- consciousness â”€â”€â–º linked_concepts â”€â”€â–º mathematics
- Rezultat: [GEB, Strange Loop, Emperor's New Mind...]
- PLUS: "Sabo je veÄ‡ Äitao GEB"
- PLUS: "Zadnji put traÅ¾io consciousness: 2024-09"

KORAK 2: PERSONALIZACIJA
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- Filter: izbaci veÄ‡ proÄitano (ili stavi niÅ¾e)
- Boost: autori koje je veÄ‡ Äitao (Hofstadter)
- Suggest: "SljedeÄ‡i logiÄni korak na tvom putu"

KORAK 3: QDRANT - Content Retrieval
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- Deep dive u specifiÄne chunkove
- Relevantni pasusi iz odabranih knjiga

KORAK 4: RESPONSE + GRAPH UPDATE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- Vrati rezultate
- ZAPIÅ I: Sabo traÅ¾io X, dobio Y, u vrijeme Z
```

---

### GRAF ENTITETA - DETALJI

#### ðŸ“š BOOK NODE
```yaml
Book:
  id: uuid
  title: string
  calibre_id: int
  
  # Relacije
  written_by: -> Author
  cites: -> Book[]
  cited_by: -> Book[]
  covers_concepts: -> Concept[]
  belongs_to_school: -> School
  from_period: -> Period
```

#### ðŸ‘¤ AUTHOR NODE
```yaml
Author:
  id: uuid
  name: string
  
  # Relacije
  wrote: -> Book[]
  influenced_by: -> Author[]
  influences: -> Author[]
  associated_with: -> School[]
```

#### ðŸ’¡ CONCEPT NODE
```yaml
Concept:
  id: uuid
  name: string
  description: string
  
  # Relacije
  related_to: -> Concept[]
  parent_concept: -> Concept
  child_concepts: -> Concept[]
  appears_in: -> Book[]
```

#### ðŸ§‘ USER JOURNEY NODE
```yaml
UserJourney:
  user_id: uuid
  
  # Temporalne relacije
  read: -> Book[] [timestamp, completion%]
  searched: -> Concept[] [timestamp, found_useful: bool]
  bookmarked: -> Chunk[] [timestamp]
  path: -> ReadingPath[] [created, active]
```

---

### TEMPORALNI UPITI
```cypher
// Å to je Sabo Äitao o consciousness PRIJE nego je otkrio Hofstadtera?
MATCH (u:User {name: "Sabo"})-[r:READ]->(b:Book)-[:COVERS]->(c:Concept {name: "consciousness"})
WHERE r.timestamp < date("2024-06-01")
RETURN b.title, r.timestamp
ORDER BY r.timestamp

// Kako je evoluiralo razumijevanje "recursion"?
MATCH path = (u:User)-[r:SEARCHED*]->(c:Concept {name: "recursion"})
RETURN r.timestamp, r.context, r.found_useful
ORDER BY r.timestamp

// PreporuÄi SLJEDEÄ†U knjigu na putu
MATCH (u:User)-[:READ]->(read:Book)-[:CITES]->(next:Book)
WHERE NOT (u)-[:READ]->(next)
AND (next)-[:COVERS]->(c:Concept)<-[:SEARCHED]-(u)
RETURN next, count(*) as relevance
ORDER BY relevance DESC
LIMIT 5
```

---

### SYNC PIPELINE
```
CALIBRE LIBRARY          GRAPHITI              QDRANT
     â”‚                      â”‚                     â”‚
     â”‚  [Nova knjiga]       â”‚                     â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                     â”‚
     â”‚                      â”‚                     â”‚
     â”‚          [Extract entities]                â”‚
     â”‚          [Create nodes]                    â”‚
     â”‚          [Detect relationships]            â”‚
     â”‚                      â”‚                     â”‚
     â”‚                      â”‚  [Chunk + Embed]    â”‚
     â”‚                      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
     â”‚                      â”‚                     â”‚
     â”‚          [Link book â†’ chunks]              â”‚
     â”‚                      â”‚                     â”‚
     
ENTITY EXTRACTION (per book):
â”œâ”€â”€ Autori (NER + metadata)
â”œâ”€â”€ Citirane knjige (bibliography parsing)
â”œâ”€â”€ Koncepti (LLM extraction)
â”œâ”€â”€ Osobe (NER)
â”œâ”€â”€ Vremenska razdoblja
â””â”€â”€ Å kole miÅ¡ljenja (LLM classification)
```

---

### FAZE IMPLEMENTACIJE

**F0: Infrastruktura**
- [ ] Neo4j instance (Docker)
- [ ] Graphiti setup
- [ ] Povezati s postojeÄ‡im Qdrant
- [ ] Basic MCP connector

**F1: Book Graph (statiÄni)**
- [ ] Book nodes iz Calibre
- [ ] Author nodes + WROTE relacije
- [ ] Concept extraction pipeline
- [ ] CITES relacije (bibliography parsing)

**F2: Relationship Discovery**
- [ ] Concept linking (RELATED_TO)
- [ ] Author influence mapping
- [ ] School/Period classification
- [ ] Cross-book concept mapping

**F3: User Journey Tracking**
- [ ] User node
- [ ] READ relacije s timestamp
- [ ] SEARCHED log
- [ ] FOUND_USEFUL feedback loop

**F4: Personalized Retrieval**
- [ ] "SljedeÄ‡a knjiga" recommendation
- [ ] "VeÄ‡ znaÅ¡" context injection
- [ ] Reading path generation
- [ ] Knowledge gap detection

**F5: Temporal Queries**
- [ ] "Kako je evoluiralo moje razumijevanje X?"
- [ ] "Å to sam znao o Y prije datuma Z?"
- [ ] "Path od knjige A do knjige B kroz koncepte"

---

### INTEGRACIJA S KNJIÅ½NIÄŒARIMA
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  KNJIÅ½NIÄŒARI (BMad agenti)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚  LIBRARIAN â”€â”€â–º Entity extraction            â”‚
â”‚               â”€â”€â–º Graph node creation       â”‚
â”‚               â”€â”€â–º Relationship detection    â”‚
â”‚                                             â”‚
â”‚  RESEARCHER â”€â”€â–º Graph traversal             â”‚
â”‚              â”€â”€â–º Temporal queries           â”‚
â”‚              â”€â”€â–º Path finding               â”‚
â”‚                                             â”‚
â”‚  CURATOR â”€â”€â”€â”€â–º User journey analysis        â”‚
â”‚             â”€â”€â–º Personalized recommendationsâ”‚
â”‚             â”€â”€â–º Reading path generation     â”‚
â”‚                                             â”‚
â”‚  ARCHIVIST â”€â”€â–º Graph health checks          â”‚
â”‚             â”€â”€â–º Orphan node detection       â”‚
â”‚             â”€â”€â–º Relationship validation     â”‚
â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### METRIKE

| Metrika | Opis | Target |
|---------|------|--------|
| Graph coverage | % knjiga s extracted entities | >90% |
| Concept linkage | Avg relacija po konceptu | >5 |
| Path findability | % uspjeÅ¡nih "Aâ†’B" upita | >80% |
| Recommendation relevance | User feedback score | >4/5 |
| Query latency | Graph traversal vrijeme | <500ms |

---

### OPEN QUESTIONS

1. **Entity extraction model** - LLM ili specializirani NER?
2. **Concept taxonomy** - Flat ili hierarchical?
3. **User privacy** - Journey data lokalno ili sync?
4. **Graph size** - Skaliranje za 50k+ knjiga?
5. **Feedback loop** - Kako korisnik oznaÄava "korisno"?

---

### REFERENCE

- [Graphiti GitHub](https://github.com/getzep/graphiti)
- [Zep Paper](https://arxiv.org/abs/2501.13956)
- [Neo4j + Graphiti Blog](https://neo4j.com/blog/developer/graphiti-knowledge-graph-memory/)
- Alexandria existing Qdrant setup